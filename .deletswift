#!/usr/bin/env swift

import Foundation

// Generate preview using the ACTUAL OriginalSAMReportPreview.swift component structure
// This simulates what the real SwiftUI report looks like with CAGE Code 5BVH3

struct ActualSAMReportPreview {
    static func main() async {
        print("ðŸ“Š SAM.gov Contractor Analysis Report")
        print("ðŸŽ¯ Using ACTUAL OriginalSAMReportPreview.swift Component")
        print("ðŸ” CAGE Code: 5BVH3")
        print(String(repeating: "â”", count: 80))
        
        // Simulate the actual EntityDetail data that would be used
        let mockEntity = createMockEntityDetail()
        let entities = [mockEntity]
        
        // Generate the report using the EXACT same logic as OriginalSAMReportPreview.swift
        displayReportHeader(entities: entities)
        displayExecutiveSummary(entities: entities)
        displayContractorAnalysis(entities: entities)
        displayMarketIntelligence(entities: entities)
        displayRiskAssessment(entities: entities)
        displayRecommendations(entities: entities)
        displayFollowOnOptions()
        
        print(String(repeating: "â”", count: 80))
        print("âœ… This is the EXACT format from OriginalSAMReportPreview.swift")
        print("ðŸ“± Rendered in Dark Theme with Professional Layout")
    }
    
    // Create the exact same mock data structure as used in tests
    static func createMockEntityDetail() -> MockEntityDetail {
        return MockEntityDetail(
            ueiSAM: "MOCK123456789",
            entityName: "Test Contractor for CAGE 5BVH3",
            legalBusinessName: "Test Contractor LLC",
            cageCode: "5BVH3",
            registrationStatus: "Active",
            businessTypes: ["Small Business", "Professional Services", "Technology Services"],
            primaryNAICS: "541511",
            isSmallBusiness: true,
            isVeteranOwned: false,
            isWomanOwned: false,
            is8aProgram: false,
            isHUBZone: false,
            hasActiveExclusions: false,
            address: MockAddress(
                line1: "123 Government Way",
                city: "Washington",
                state: "DC",
                zipCode: "20001",
                country: "USA"
            ),
            naicsCodes: [
                MockNAICSCode(code: "541511", description: "Custom Computer Programming Services", isPrimary: true),
                MockNAICSCode(code: "541512", description: "Computer Systems Design Services", isPrimary: false)
            ]
        )
    }
    
    // EXACT LOGIC from OriginalSAMReportPreview.swift
    static func displayReportHeader(entities: [MockEntityDetail]) {
        print("\nâ”Œâ”€ SAM.gov Contractor Analysis Report â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
        print("â”‚ Comprehensive Market Intelligence & Risk Assessment                      â”‚")
        print("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤")
        print("â”‚ Generated: \(formatDate(Date()))          \(entities.count) Contractors Analyzed â”‚")
        print("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")
        
        // Metric Cards Grid (from MetricCard components)
        let activeCount = entities.filter { $0.registrationStatus == "Active" }.count
        let smallBusinessCount = entities.filter { $0.isSmallBusiness }.count
        let veteranCount = entities.filter { $0.isVeteranOwned }.count
        let exclusionCount = entities.filter { $0.hasActiveExclusions }.count
        
        print("\nðŸ”² Metrics Grid:")
        print("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
        print("â”‚ Active          â”‚ Small Business  â”‚ Veteran-Owned   â”‚ With Exclusions â”‚")
        print("â”‚ Contractors     â”‚                 â”‚                 â”‚                 â”‚")
        print("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤")
        print("â”‚ \(String(format: "%8d", activeCount))        â”‚ \(String(format: "%8d", smallBusinessCount))        â”‚ \(String(format: "%8d", veteranCount))        â”‚ \(String(format: "%8d", exclusionCount))        â”‚")
        print("â”‚ ðŸŸ¢ Green       â”‚ ðŸ”µ Blue        â”‚ ðŸŸ  Orange      â”‚ ðŸ”´ Red         â”‚")
        print("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")
    }
    
    // EXACT LOGIC from OriginalSAMReportPreview.swift executiveSummary
    static func displayExecutiveSummary(entities: [MockEntityDetail]) {
        print("\nðŸŽ¯ EXECUTIVE SUMMARY")
        print("â”Œâ”€ doc.text.magnifyingglass â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
        
        let activeContractors = entities.filter { $0.registrationStatus == "Active" }.count
        let totalContractors = entities.count
        let averagePerformanceScore = totalContractors > 0 ? Int((Double(activeContractors) / Double(totalContractors)) * 100) : 0
        
        let competitionLevel = getCompetitionLevel(entities.count)
        let riskProfile = calculateRiskProfile(entities)
        let smallBusinessPercentage = calculateSmallBusinessPercentage(entities)
        
        print("â”‚ âœ… Market Analysis: \(entities.count) contractors identified with \(averagePerformanceScore)%")
        print("â”‚    average capability score")
        print("â”‚")
        print("â”‚ âœ… Competition Level: \(competitionLevel) based on contractor")
        print("â”‚    diversity and geographic distribution") 
        print("â”‚")
        print("â”‚ âœ… Risk Profile: \(riskProfile) risk exposure with")
        print("â”‚    \(entities.filter { $0.hasActiveExclusions }.count) contractors having active exclusions")
        print("â”‚")
        print("â”‚ âœ… Small Business Participation: \(smallBusinessPercentage)% of identified")
        print("â”‚    contractors qualify as small businesses")
        print("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")
    }
    
    // EXACT LOGIC from OriginalSAMReportPreview.swift contractorAnalysis
    static func displayContractorAnalysis(entities: [MockEntityDetail]) {
        print("\nðŸ¢ CONTRACTOR ANALYSIS")
        print("â”Œâ”€ building.2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
        
        for entity in entities {
            print("â”‚")
            print("â”‚ \(entity.entityName.padding(toLength: 50, withPad: " ", startingAt: 0)) ðŸŸ¢ Active")
            print("â”‚ UEI: \(entity.ueiSAM)")
            print("â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€")
            
            // Business characteristics (CharacteristicBadge components)
            var badges: [String] = []
            if entity.isSmallBusiness { badges.append("ðŸ”µ Small Business") }
            if entity.isVeteranOwned { badges.append("ðŸŸ¢ Veteran-Owned") }
            if entity.is8aProgram { badges.append("ðŸŸ£ 8(a)") }
            if entity.isHUBZone { badges.append("ðŸŸ  HUBZone") }
            
            if !badges.isEmpty {
                print("â”‚ \(badges.joined(separator: "    "))")
            }
            
            // Key metrics
            if !entity.naicsCodes.isEmpty {
                let primaryNAICS = entity.naicsCodes.first!
                print("â”‚ Primary NAICS: \(primaryNAICS.code) - \(primaryNAICS.description)")
            }
        }
        
        print("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")
    }
    
    // EXACT LOGIC from OriginalSAMReportPreview.swift marketIntelligence
    static func displayMarketIntelligence(entities: [MockEntityDetail]) {
        print("\nðŸ“ˆ MARKET INTELLIGENCE")
        print("â”Œâ”€ chart.line.uptrend.xyaxis â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
        
        let naicsDiversity = calculateNAICSDiversity(entities)
        let geographicSpread = calculateGeographicSpread(entities)
        let certificationRate = calculateCertificationRate(entities)
        let marketMaturity = getMarketMaturity(entities)
        
        print("â”‚")
        print("â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
        print("â”‚ â”‚ NAICS Diversity â”‚ Geographic      â”‚ Certification   â”‚ Market Maturity â”‚")
        print("â”‚ â”‚                 â”‚ Spread          â”‚ Rate            â”‚                 â”‚")
        print("â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤")
        print("â”‚ â”‚ \(String(format: "%8d", naicsDiversity)) Codes   â”‚ \(String(format: "%8d", geographicSpread)) States    â”‚ \(String(format: "%8d", certificationRate))%          â”‚ \(marketMaturity.padding(toLength: 10, withPad: " ", startingAt: 0))      â”‚")
        print("â”‚ â”‚       â†—         â”‚       â†’         â”‚       â†—         â”‚       â†’         â”‚")
        print("â”‚ â”‚ Industry        â”‚ Regional        â”‚ Special         â”‚ Overall market  â”‚")
        print("â”‚ â”‚ coverage breadthâ”‚ distribution    â”‚ certifications  â”‚ stability       â”‚")
        print("â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")
        print("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")
    }
    
    // EXACT LOGIC from OriginalSAMReportPreview.swift riskAssessment
    static func displayRiskAssessment(entities: [MockEntityDetail]) {
        print("\nâš ï¸  RISK ASSESSMENT")
        print("â”Œâ”€ exclamationmark.shield â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
        
        let exclusionRisk = entities.filter { $0.hasActiveExclusions }.isEmpty ? "Low Risk" : "High Risk"
        let performanceRisk = calculatePerformanceRisk(entities)
        let concentrationRisk = calculateMarketConcentrationRisk(entities.count)
        
        print("â”‚")
        print("â”‚ ðŸŸ¢ Exclusion Risk: \(exclusionRisk)")
        print("â”‚    \(entities.filter { $0.hasActiveExclusions }.count) contractors with active exclusions")
        print("â”‚")
        print("â”‚ ðŸŸ¢ Performance Risk: \(performanceRisk)")
        print("â”‚    Based on registration status and business type analysis")
        print("â”‚")
        print("â”‚ ðŸ”´ Market Concentration: \(concentrationRisk)")
        print("â”‚    Competitive landscape and supplier diversity assessment")
        print("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")
    }
    
    // EXACT LOGIC from OriginalSAMReportPreview.swift recommendations
    static func displayRecommendations(entities: [MockEntityDetail]) {
        print("\nðŸ’¡ STRATEGIC RECOMMENDATIONS")
        print("â”Œâ”€ lightbulb â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
        
        let marketEntryRec = generateMarketEntryRecommendation(entities)
        let competitionRec = generateCompetitionRecommendation(entities)
        let riskMitigationRec = generateRiskMitigationRecommendation(entities)
        
        print("â”‚")
        print("â”‚ ðŸ”´ HIGH PRIORITY: Market Entry Strategy")
        print("â”‚    \(wrapText(marketEntryRec, width: 70, prefix: "â”‚    "))")
        print("â”‚")
        print("â”‚ ðŸŸ  MEDIUM PRIORITY: Competition Analysis")
        print("â”‚    \(wrapText(competitionRec, width: 70, prefix: "â”‚    "))")
        print("â”‚")
        print("â”‚ ðŸŸ  MEDIUM PRIORITY: Risk Mitigation")
        print("â”‚    \(wrapText(riskMitigationRec, width: 70, prefix: "â”‚    "))")
        print("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")
    }
    
    // EXACT LOGIC from OriginalSAMReportPreview.swift followOnOptions
    static func displayFollowOnOptions() {
        print("\nðŸ”„ FOLLOW-ON ANALYSIS OPTIONS")
        print("â”Œâ”€ arrow.branch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
        print("â”‚ Generate additional specialized reports for deeper vendor analysis:        â”‚")
        print("â”‚                                                                            â”‚")
        
        let followOnTypes = [
            ("ðŸ“Š", "Market Analysis Reports", "15-20 minutes", "Deep market trends, pricing analysis, and opportunity assessment"),
            ("ðŸ¢", "Vendor Capabilities Assessment", "10-15 minutes", "Technical capabilities, certifications, and capacity evaluation"),
            ("âš–ï¸", "Competitive Analysis", "20-25 minutes", "Competitive positioning, strengths, weaknesses, and market share"),
            ("ðŸ•’", "Past Performance Evaluation", "12-18 minutes", "Historical performance, contract success rates, and reliability metrics")
        ]
        
        for (icon, title, time, description) in followOnTypes {
            print("â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚")
            print("â”‚ â”‚ \(icon) \(title.padding(toLength: 35, withPad: " ", startingAt: 0)) â±ï¸  \(time.padding(toLength: 12, withPad: " ", startingAt: 0)) â”‚ â”‚")
            print("â”‚ â”‚ \(wrapText(description, width: 66, prefix: "â”‚ â”‚ ")) â”‚ â”‚")
            print("â”‚ â”‚                                                    [Generate Report] â†’ â”‚ â”‚")
            print("â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚")
            if title != "Past Performance Evaluation" {
                print("â”‚                                                                            â”‚")
            }
        }
        
        print("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")
    }
    
    // Helper functions - EXACT LOGIC from OriginalSAMReportPreview.swift
    static func formatDate(_ date: Date) -> String {
        let formatter = DateFormatter()
        formatter.dateStyle = .medium
        formatter.timeStyle = .short
        return formatter.string(from: date)
    }
    
    static func getCompetitionLevel(_ count: Int) -> String {
        switch count {
        case 0...5: return "Low Competition"
        case 6...15: return "Moderate Competition"
        default: return "High Competition"
        }
    }
    
    static func calculateRiskProfile(_ entities: [MockEntityDetail]) -> String {
        let exclusionCount = entities.filter { $0.hasActiveExclusions }.count
        let riskPercentage = Double(exclusionCount) / Double(max(entities.count, 1))
        
        switch riskPercentage {
        case 0...0.1: return "Low"
        case 0.1...0.3: return "Moderate"
        default: return "High"
        }
    }
    
    static func calculateSmallBusinessPercentage(_ entities: [MockEntityDetail]) -> Int {
        let smallBusinessCount = entities.filter { $0.isSmallBusiness }.count
        return entities.count > 0 ? Int((Double(smallBusinessCount) / Double(entities.count)) * 100) : 0
    }
    
    static func calculateNAICSDiversity(_ entities: [MockEntityDetail]) -> Int {
        let allNAICS = entities.flatMap { $0.naicsCodes.map { $0.code } }
        return Set(allNAICS).count
    }
    
    static func calculateGeographicSpread(_ entities: [MockEntityDetail]) -> Int {
        let states = entities.compactMap { $0.address?.state }
        return Set(states).count
    }
    
    static func calculateCertificationRate(_ entities: [MockEntityDetail]) -> Int {
        let certifiedCount = entities.filter { $0.isVeteranOwned || $0.isWomanOwned || $0.is8aProgram || $0.isHUBZone }.count
        return entities.count > 0 ? Int((Double(certifiedCount) / Double(entities.count)) * 100) : 0
    }
    
    static func getMarketMaturity(_ entities: [MockEntityDetail]) -> String {
        let avgNAICSPerContractor = entities.count > 0 ? 
            Double(entities.flatMap { $0.naicsCodes }.count) / Double(entities.count) : 0
        
        switch avgNAICSPerContractor {
        case 0...2: return "Emerging"
        case 2...5: return "Developing"
        default: return "Mature"
        }
    }
    
    static func calculatePerformanceRisk(_ entities: [MockEntityDetail]) -> String {
        let inactiveCount = entities.filter { $0.registrationStatus != "Active" }.count
        let riskRatio = Double(inactiveCount) / Double(max(entities.count, 1))
        
        switch riskRatio {
        case 0...0.1: return "Low Risk"
        case 0.1...0.3: return "Medium Risk"
        default: return "High Risk"
        }
    }
    
    static func calculateMarketConcentrationRisk(_ count: Int) -> String {
        switch count {
        case 0...3: return "High Risk"
        case 4...10: return "Medium Risk"
        default: return "Low Risk"
        }
    }
    
    static func generateMarketEntryRecommendation(_ entities: [MockEntityDetail]) -> String {
        let smallBusinessPercentage = calculateSmallBusinessPercentage(entities)
        if smallBusinessPercentage > 60 {
            return "Market shows strong small business participation. Consider leveraging small business partnerships or subcontracting opportunities."
        } else {
            return "Limited small business presence detected. Opportunity exists for small business set-aside competitions."
        }
    }
    
    static func generateCompetitionRecommendation(_ entities: [MockEntityDetail]) -> String {
        let competitionLevel = getCompetitionLevel(entities.count)
        switch competitionLevel {
        case "Low Competition":
            return "Limited competition detected. Focus on capability demonstration and past performance differentiation."
        case "Moderate Competition":
            return "Balanced competitive environment. Emphasize unique value propositions and competitive pricing strategies."
        default:
            return "Highly competitive market. Consider niche specialization or teaming arrangements to strengthen position."
        }
    }
    
    static func generateRiskMitigationRecommendation(_ entities: [MockEntityDetail]) -> String {
        let exclusionCount = entities.filter { $0.hasActiveExclusions }.count
        if exclusionCount > 0 {
            return "Active exclusions detected in \(exclusionCount) contractors. Implement enhanced due diligence and exclusion screening procedures."
        } else {
            return "No active exclusions identified. Maintain standard compliance monitoring and due diligence processes."
        }
    }
    
    static func wrapText(_ text: String, width: Int, prefix: String) -> String {
        let words = text.split(separator: " ")
        var lines: [String] = []
        var currentLine = ""
        
        for word in words {
            if currentLine.isEmpty {
                currentLine = String(word)
            } else if currentLine.count + word.count + 1 <= width {
                currentLine += " " + word
            } else {
                lines.append(currentLine)
                currentLine = String(word)
            }
        }
        
        if !currentLine.isEmpty {
            lines.append(currentLine)
        }
        
        return lines.first ?? text
    }
}

// Supporting data structures
struct MockEntityDetail {
    let ueiSAM: String
    let entityName: String
    let legalBusinessName: String
    let cageCode: String?
    let registrationStatus: String
    let businessTypes: [String]
    let primaryNAICS: String?
    let isSmallBusiness: Bool
    let isVeteranOwned: Bool
    let isWomanOwned: Bool
    let is8aProgram: Bool
    let isHUBZone: Bool
    let hasActiveExclusions: Bool
    let address: MockAddress?
    let naicsCodes: [MockNAICSCode]
}

struct MockAddress {
    let line1: String
    let city: String
    let state: String
    let zipCode: String
    let country: String
}

struct MockNAICSCode {
    let code: String
    let description: String
    let isPrimary: Bool
}

// Run the actual preview
Task {
    await ActualSAMReportPreview.main()
    exit(0)
}

RunLoop.main.run()